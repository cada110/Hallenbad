import requests
import csv
from datetime import datetime
from pathlib import Path

URL = "https://www.stadt-zuerich.ch/de/stadtleben/sport-und-erholung/sport-und-badeanlagen/hallenbaeder/city.html#aktuelle_auslastung"

HEADERS = {
    "User-Agent": "Mozilla/5.0",
    "Accept": "application/json"
}

response = requests.get(URL, headers=HEADERS, timeout=10)
response.raise_for_status()
data = response.json()

timestamp = datetime.now().isoformat()
currentfill = int(data["currentfill"])

file = Path("data.csv")
new = not file.exists()

with open(file, "a", newline="", encoding="utf-8") as f:
    writer = csv.writer(f)
    if new:
        writer.writerow(["timestamp", "currentfill"])
    writer.writerow([timestamp, currentfill])

print("Gespeichert:", timestamp, currentfill)
